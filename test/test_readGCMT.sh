#!/bin/bash

#####
#	SET PATH TO TEST_VALUES SCRIPT
#####
TEST_BIN_DIR=$(echo $0 | xargs dirname)


#####
#	SET PATH TO HDEF EXECUTABLE
#####
# Check for o92util
$TEST_BIN_DIR/test_find_hdef_exec.sh readGCMT || { echo "$0: could not find readGCMT; exiting" 1>&2; exit 1; }
BIN_DIR=$(cat hdefexec.tmp | xargs dirname)


#####
#	RUN TEST
#####
trap "rm -f *.tmp" 0 1 2 3 8 9


# TEST FOR GCMT FILE!!!!
GCMT_FILE=`$BIN_DIR/readGCMT -mag 9 10 2>&1 | grep "no GCMT file"`
if [ "$GCMT_FILE" != "" ]
then
    echo No GCMT file to test 1>&2
    exit
fi

$BIN_DIR/readGCMT -mag 9 10 > gcmt.tmp
cat > answer.tmp << EOF
2004-12-26T00:58:50    94.260     3.090    28.6    9.03    1.0400E+22   -4.2700E+21   -6.1000E+21    2.9800E+22   -2.4000E+22    4.2600E+21
2011-03-11T05:46:23   143.050    37.520    20.0    9.12    1.7300E+22   -2.8100E+21   -1.4500E+22    2.1200E+22    4.5500E+22   -6.5700E+21
EOF
$TEST_BIN_DIR/test_values.sh answer.tmp gcmt.tmp 11 "readGCMT: magnitude" || exit 1


$BIN_DIR/readGCMT -date 2014-03-14T00:00:00 2014-04-14T00:00:00 -rect -75 -65 -21 -18 > gcmt.tmp
cat > answer.tmp << EOF
2014-03-16T21:16:29   289.080   -19.940    12.0    6.70    9.3000E+18   -6.8000E+18   -2.5000E+18    3.5200E+18   -8.7500E+18    2.9500E+18
2014-03-17T01:34:55   288.990   -19.840    22.3    5.19    6.0900E+16   -3.8500E+15   -5.7000E+16   -3.5700E+16    1.2000E+15   -1.2700E+16
2014-03-17T05:11:34   288.950   -20.010    17.8    6.41    2.5100E+18    1.0300E+17   -2.6100E+18    8.3900E+17   -3.7800E+18    5.1600E+17
2014-03-17T08:32:35   289.090   -20.020    23.3    5.13   -3.1400E+16   -6.6900E+15    3.8100E+16    3.5200E+16    1.2300E+16    2.0400E+16
2014-03-17T11:12:14   288.970   -19.920    20.7    5.07    3.4800E+16   -1.5900E+15   -3.3200E+16    5.5200E+15   -2.8600E+16    6.9200E+15
2014-03-17T19:05:26   288.970   -19.970    14.6    4.96    2.8900E+16   -9.7300E+15   -1.9200E+16    2.0000E+13   -1.3600E+16    1.0400E+16
2014-03-18T14:35:56   288.900   -20.130    21.6    5.14    5.0500E+16    4.2000E+14   -5.0900E+16    3.2000E+15   -2.6800E+16    8.6200E+15
2014-03-18T21:26:45   288.980   -20.010    13.6    5.86    3.7800E+17    4.6000E+15   -3.8300E+17   -1.0300E+16   -5.8700E+17   -5.1900E+16
2014-03-22T12:59:59   288.860   -19.730    18.9    6.27    1.7900E+18    4.7000E+16   -1.8400E+18    4.8500E+17   -2.1000E+18    4.7200E+17
2014-03-22T13:29:58   288.800   -19.670    22.8    5.59    2.2400E+17   -1.4700E+16   -2.1000E+17    2.6000E+16   -1.6500E+17    3.7800E+16
2014-03-22T22:14:58   288.780   -19.700    27.3    5.14    4.6600E+16    3.0000E+14   -4.6900E+16    6.3000E+15   -3.3100E+16    9.0500E+15
2014-03-23T18:20:01   288.950   -19.700    21.7    6.27    1.8500E+18   -4.0000E+15   -1.8500E+18    7.8900E+17   -2.0000E+18    5.4300E+17
2014-03-23T20:23:03   288.890   -20.010    31.6    5.32    8.0400E+16    1.4900E+16   -9.5300E+16    3.7200E+16   -3.5200E+16    3.2800E+16
2014-03-23T22:04:26   288.880   -19.760    31.1    5.18    3.6500E+16   -4.8000E+15   -3.1700E+16    2.2200E+16   -4.6600E+16    2.4700E+16
2014-03-24T11:26:39   288.950   -19.800    21.9    5.78    3.4000E+17    2.3500E+16   -3.6400E+17    8.5400E+16   -3.7300E+17    7.4900E+16
2014-03-24T11:32:15   288.750   -19.840    33.0    5.39    1.0900E+17   -8.5000E+15   -1.0000E+17    1.7000E+16   -8.1200E+16    1.6400E+16
2014-03-24T11:40:43   288.880   -19.800    27.4    5.70    2.5700E+17    5.1000E+15   -2.6200E+17    4.6300E+16   -3.0200E+17    3.7800E+16
2014-03-24T12:32:50   288.850   -19.720    33.5    5.16    5.3000E+16   -2.5800E+15   -5.0400E+16    5.8000E+15   -3.2500E+16    4.4900E+15
2014-03-24T15:45:31   288.940   -19.540    29.1    5.74    2.9500E+17    9.3000E+15   -3.0400E+17    8.0800E+16   -3.3600E+17    7.9700E+16
2014-03-24T18:43:12   289.020   -19.660    31.3    5.09    3.9700E+16   -3.5100E+15   -3.6200E+16    9.2100E+15   -2.6200E+16    1.0400E+16
2014-03-25T00:15:12   288.990   -19.830    23.5    5.33    7.8000E+16   -3.6000E+15   -7.4300E+16    2.7400E+16   -6.7600E+16    3.4200E+16
2014-03-31T12:53:06   290.730   -19.540   129.9    5.59   -1.5400E+17    1.7600E+17   -2.1900E+16    2.6800E+16   -1.7900E+17    1.1900E+17
2014-04-01T23:46:47   289.190   -19.700    21.6    8.15    9.2000E+20   -3.9000E+19   -8.8100E+20    6.3700E+20   -1.5300E+21    2.0500E+20
2014-04-01T23:57:58   288.610   -19.850    20.6    7.03    3.1400E+19   -2.3900E+18   -2.9000E+19   -2.4000E+17   -2.5200E+19    3.9100E+18
2014-04-02T19:45:51   289.130   -20.360    31.5    5.34    9.5800E+16   -2.6000E+15   -9.3200E+16    1.2700E+16   -6.6900E+16    4.7000E+15
2014-04-03T00:01:16   288.790   -19.800    25.7    5.19    5.6400E+16   -6.8500E+15   -4.9500E+16    1.7300E+16   -3.6400E+16    9.6100E+15
2014-04-03T01:58:30   289.120   -20.340    33.7    6.62    6.6500E+18    4.7000E+17   -7.1200E+18    1.6200E+18   -6.3900E+18    1.3600E+18
2014-04-03T02:43:11   289.400   -20.430    28.7    7.76    2.2000E+20    4.6000E+18   -2.2400E+20    1.2200E+20   -4.2000E+20    3.8000E+19
2014-04-03T05:26:15   289.100   -20.720    32.2    6.53    6.0400E+18   -7.7000E+17   -5.2700E+18    1.3700E+18   -4.0300E+18    2.1300E+17
2014-04-04T01:37:50   289.090   -20.610    19.5    6.26    1.9400E+18    7.8000E+16   -2.0200E+18    7.7800E+17   -1.6900E+18    3.7600E+17
2014-04-04T09:38:55   288.700   -20.030    18.9    5.28    6.6700E+16    3.4000E+15   -7.0100E+16    1.4300E+16   -5.9800E+16    1.8500E+16
2014-04-04T15:20:59   288.770   -19.880    32.0    5.03    3.4600E+16   -4.7000E+15   -2.9900E+16    4.2600E+15   -1.8400E+16    1.0200E+16
2014-04-04T16:02:41   289.260   -20.420    13.2    4.90    2.1400E+16   -2.0900E+16   -5.4000E+14   -8.5900E+15    6.9900E+15    6.6800E+15
2014-04-05T00:33:57   289.160   -20.130    33.0    5.13    4.0800E+16    6.1900E+15   -4.7000E+16    6.6000E+15   -3.1800E+16    7.7500E+15
2014-04-05T04:05:03   288.930   -20.750    29.9    5.13    4.0100E+16    3.4000E+14   -4.0400E+16    1.8300E+16   -3.1000E+16    1.2100E+16
2014-04-05T05:44:56   289.210   -20.130    29.5    5.30    7.7400E+16    4.6000E+15   -8.2000E+16    2.2100E+16   -5.4200E+16    1.6300E+16
2014-04-05T07:54:19   288.850   -19.840    29.0    4.94    2.8700E+16   -3.4500E+15   -2.5300E+16    1.3200E+15   -9.2400E+15    3.3800E+15
2014-04-05T14:04:49   288.950   -20.240    18.7    5.01    3.6600E+16   -1.2300E+16   -2.4400E+16   -9.1700E+15   -2.0500E+15    1.4100E+16
2014-04-06T14:06:08   288.840   -20.400    15.0    5.35   -8.9000E+15    1.4600E+16   -5.7000E+15    4.3500E+16   -1.1000E+17   -7.9000E+15
2014-04-07T06:24:23   288.950   -20.660    21.8    4.89    2.2000E+16   -1.8400E+15   -2.0200E+16   -5.0000E+14   -1.0300E+16    4.4600E+15
2014-04-07T13:43:21   289.120   -20.130    16.8    5.79    2.1900E+17   -3.5200E+17    1.3300E+17   -4.2800E+17    1.1700E+17   -1.0400E+17
2014-04-08T05:20:21   288.860   -19.800    28.0    4.99    2.8900E+16   -3.2800E+15   -2.5600E+16    5.3000E+15   -1.8600E+16    6.9800E+15
2014-04-08T05:43:56   289.010   -20.430    20.7    4.95    3.0200E+16   -5.7500E+15   -2.4400E+16    3.6100E+15   -7.3000E+15    9.1200E+15
2014-04-08T10:14:31   288.850   -20.620    12.4    5.60    1.5400E+17    6.6000E+15   -1.6000E+17   -9.4600E+16   -2.0900E+17   -3.8500E+16
2014-04-09T04:32:55   288.690   -19.760    19.6    5.05    3.3800E+16   -2.5800E+15   -3.1200E+16    1.4900E+15   -2.5600E+16    7.6100E+15
2014-04-09T11:14:43   288.890   -20.650    14.7    5.27    6.1900E+16    2.0000E+15   -6.3900E+16    1.2500E+16   -6.4400E+16    1.2400E+16
2014-04-10T17:49:10   288.690   -19.870    21.1    5.15    4.0500E+16   -1.3300E+15   -3.9100E+16   -2.9000E+14   -4.0800E+16    1.4400E+16
2014-04-11T00:01:45   289.120   -20.640    14.5    6.12    9.0500E+17    3.7400E+17   -1.2800E+18   -5.1200E+17   -1.1600E+18    1.3500E+17
2014-04-13T12:11:30   288.990   -20.580    21.8    5.46    1.1300E+17   -4.2000E+15   -1.0900E+17    4.1300E+16   -1.2100E+17    2.7800E+16
EOF
$TEST_BIN_DIR/test_values.sh answer.tmp gcmt.tmp 11 "readGCMT: date, location" || exit 1
